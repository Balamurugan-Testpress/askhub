{% load widget_tweaks %}
{% load humanize %}
<div style="margin-left: {{ depth|default:0 }}px"
     class="border-start border-2 ps-3 mb-4">
  <div class="py-2">
    <div class="d-flex justify-content-between align-items-center mb-1">
      <small class="text-muted">
        <strong>{{ comment.author.username }}</strong>
        â€¢ {{ comment.created_at|naturaltime }}
      </small>
    </div>
    <p class="mb-2">{{ comment.content|linebreaksbr }}</p>
    <div class="mb-2"></div>
    <div class="mb-2">
      <button class="btn btn-sm btn-outline-primary me-2"
              type="button"
              onclick="this.nextElementSibling.classList.toggle('d-none')">
        <i class="bi bi-reply"></i> Reply
      </button>
      <form method="post" class="card card-body d-none mt-2 border-0 shadow-sm">
        {% csrf_token %}
        <input type="hidden" name="parent_comment_id" value="{{ comment.id }}">
        <div class="mb-2">
          {% render_field comment_form.content class="form-control" rows="2" placeholder="Write a reply..." %}
        </div>
        <div class="d-flex justify-content-end">
          <button type="button"
                  class="btn btn-sm btn-link"
                  onclick="this.closest('form').classList.add('d-none')">Cancel</button>
          <button type="submit" class="btn btn-sm btn-success ms-2">Submit</button>
        </div>
      </form>
    </div>
    {% if comment.replies.exists %}
      <button class="btn btn-sm btn-outline-secondary mb-2"
              type="button"
              onclick="this.nextElementSibling.classList.toggle('d-none')">
        <i class="bi bi-chat-dots"></i> Toggle Replies ({{ comment.replies.count }})
      </button>
      <div class="">
        {% for reply in comment.replies.all %}
          {% include "comments/_comment.html" with comment=reply depth=depth|add:"14" comment_form=comment_form comment_vote_map=comment_vote_map %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>
