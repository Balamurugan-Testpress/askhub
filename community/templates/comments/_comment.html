{% load widget_tweaks %}
{% load humanize %}
<div class="ps-4 border-start border-2 border-secondary ms-{{ depth|default:0 }}">
  <div class="py-2">
    <div class="d-flex justify-content-between align-items-center mb-1">
      <div class="text-muted small">
        <strong>{{ comment.author.username }}</strong>
        â€¢ {{ comment.created_at|naturaltime }}
      </div>
    </div>
    <p class="mb-2">{{ comment.content }}</p>
    <button class="btn btn-sm btn-outline-secondary"
            type="button"
            onclick="this.nextElementSibling.classList.toggle('d-none')">
      <i class="bi bi-reply"></i> Reply
    </button>
    <form method="post" class="d-none mt-y mb-4">
      {% csrf_token %}
      <input type="hidden" name="parent_comment_id" value="{{ comment.id }}">
      <div class="mb-2">
        {% render_field comment_form.content class="form-control" rows="2" placeholder="Write a reply..." %}
      </div>
      <button type="submit" class="btn btn-sm btn-primary">Submit</button>
      <button type="button"
              class="btn btn-sm btn-link"
              onclick="this.closest('form').classList.add('d-none')">Cancel</button>
      <br>
    </form>
    <button class="btn  btn-sm btn-outline-secondary"
            type="button"
            onclick="this.nextElementSibling.classList.toggle('d-none')">Toggle Replies</button>
    <div class="mt-2">
      {% for reply in comment.replies.all %}
        {% include "comments/_comment.html" with comment=reply depth=depth|add:"6" %}
      {% endfor %}
    </div>
  </div>
</div>
